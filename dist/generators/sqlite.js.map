{"version":3,"sources":["../../src/generators/sqlite.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAGA,IAAM,KAAK,GAAG;AACZ,IAAE,EAAE,mCAAmC;AACvC,QAAM,EAAE,MAAM;AACd,SAAO,EAAE,SAAS;AAClB,MAAI,EAAE,MAAM;AACZ,QAAM,EAAE,MAAM;AACd,OAAK,EAAE,MAAM;AACb,SAAO,EAAE,SAAS;AAClB,WAAS,EAAE,MAAM;CAClB,CAAC;;IAEmB,MAAM;YAAN,MAAM;;WAAN,MAAM;0BAAN,MAAM;;kEAAN,MAAM;;;eAAN,MAAM;;kCACX,MAAM,EAAE;AACpB,aAAO,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,MAAM,CAAC;KACrC;;;oCAEe,UAAU,EAAE;AAC1B,aAAO,UAnBH,MAAM,EAmBC,kBAAkB,EAAE,UAAU,CAAC,CAAC;KAC5C;;;sCAEiB,UAAU,EAAE;AAC5B,aAAO,UAvBH,MAAM,EAuBC,QAAQ,GACR,sCAAsC,GACtC,gCAAgC,GAChC,wFAAwF,GACxF,wBAAwB,GACxB,MAAM,EACN,UAAU,EAAE,UAAU,EAAE,UAAU,EAAE,UAAU,CAAC,CAAC;KAC5D;;;gCAEW,MAAM,EAAE;AAClB,UAAM,MAAM,GAAG,MAAM,CAAC,MAAM,GAAG,SAAS,GAAG,EAAE,CAAC;;AAE9C,aAAO,UAnCH,MAAM,EAmCC,6CAA6C,EAC7C,MAAM,EACN,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,EAAE,MAAM,CAAC,OAAO,CAAC,EAC/C,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,EAC/B,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;KACvC;;;2BAEM,UAAU,EAAE;AACjB,UAAI,UAAU,IAAI,IAAI,IAAI,UAAU,CAAC,MAAM,KAAK,CAAC,EAAE;AACjD,eAAO,EAAE,CAAC;OACX;;AAED,aAAO,GAAG,GAAG,UAAU,GAAG,GAAG,CAAC;KAC/B;;;SAnCkB,MAAM;;;kBAAN,MAAM","file":"sqlite.js","sourcesContent":["import SchemaGenerator from '../schema-generator';\nimport {format as fmt} from 'util';\n\nconst TYPES = {\n  pk: 'INTEGER PRIMARY KEY AUTOINCREMENT',\n  string: 'TEXT',\n  integer: 'INTEGER',\n  date: 'REAL',\n  double: 'REAL',\n  array: 'TEXT',\n  boolean: 'INTEGER',\n  timestamp: 'REAL'\n};\n\nexport default class Sqlite extends SchemaGenerator {\n  typeForColumn(column) {\n    return TYPES[column.type] || 'TEXT';\n  }\n\n  transformToText(columnName) {\n    return fmt('CAST(%s AS text)', columnName);\n  }\n\n  transformToDouble(columnName) {\n    return fmt('(CASE ' +\n               'WHEN LENGTH(TRIM(%s)) = 0 THEN NULL ' +\n               'WHEN CAST(%s AS REAL) = 0 AND ' +\n               \"LENGTH(TRIM(REPLACE(REPLACE(REPLACE(%s, '.', ''), '0', ' '), '-', ''))) > 0 THEN NULL \" +\n               'ELSE CAST(%s AS REAL) ' +\n               'END)',\n               columnName, columnName, columnName, columnName);\n  }\n\n  createIndex(change) {\n    const unique = change.unique ? 'UNIQUE ' : '';\n\n    return fmt('CREATE %sINDEX IF NOT EXISTS %s ON %s (%s);',\n               unique,\n               this.indexName(change.newTable, change.columns),\n               this.tableName(change.newTable),\n               change.columns.join(', '));\n  }\n\n  escape(identifier) {\n    if (identifier == null || identifier.length === 0) {\n      return '';\n    }\n\n    return '`' + identifier + '`';\n  }\n}\n"]}